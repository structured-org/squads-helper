# SQUADS JLP Helper

This script automatically posts proposals into multisig with a different payload

# Building

## Dependencies

Dependencies for the project can be installed as easy as

```bash
yarn install
```

## Configuration

First, inside of the project's directory create `.env` file. It's content should be similar to this template:

```bash
CONFIG_PATH = /absolute/path/to/this/repo/jup-playground/config.yaml
ANCHOR_PROVIDER_URL = https://api.mainnet-beta.solana.com
ANCHOR_WALLET = /absolute/path/to/your/key/.config/solana/id.json
```

> We personally recommend you to use a provider instead of a public node. For example, QuickNode

Notice that `ANCHOR_WALLET` file is an absolute path to the serialized key previously generated by the `solana-keygen` binary.
`CONFIG_PATH` points to the project's folder where next you should create a file called `config.yaml`, there you write all the information about your multisig and what liquidity you would like to provide from the multisig behalf. Example configuration for `WSOL` looks so:

```YAML
squads_multisig:
  program_idl: /absolte/path/to/repo/squads-jlp-helper/idl/squads_multisig.json
  multisig_address: <web3.PublicKey>
  vault_pda: <web3.PublicKey>

wormhole:
  coins:
    - coin: WBTC
      decimals: 8
      token_address: 3NZ9JMVBmGAqocybic2c7LQCJScmgsAZ6vQqTDzcqmJh
  chains:
    - name: Ethereum
      alt_table: GgiDHrbL3s6yaNeXi7Kd5BhkHRq6xL2geoKXUUqEZSN5
      token_bridge_relayer: 3vxKRPwUTiEkeUVyoZ9MXFe1V71sRLbLqu1gRYaWmehQ
      token_bridge: wormDTUJ6AWPNvk59vGQbDvGJmqbDTdgWgAqcLBCgUb
      core_bridge: worm2ZoG2kUd4vFXhvjh93UUH596ayRfgQ2MgjNMTth
      accounts:
        - 7oPa2PHQdZmjSPqvpZN7MQxnC7Dcf3uL4oLqknGLk2S3
        - 2yVjuQwpsvdsrywzsJJVs9Ueh4zayyo5DYJbBNc3DDpn
        - Gv1KWf8DT1jKv5pKBmGaTmVszqa56Xn8YGx2Pg7i7qAk
        - 9bFNrXNb2WTx8fMHXCheaZqkLZ3YCCaiqTftHxeintHy
        - worm2ZoG2kUd4vFXhvjh93UUH596ayRfgQ2MgjNMTth
        - wormDTUJ6AWPNvk59vGQbDvGJmqbDTdgWgAqcLBCgUb

jupiter_perps:
  program_idl: /absolte/path/to/repo/squads-jlp-helper/idl/perpetuals.json
  program: PERPHjGBqRHArX4DySjwM6UJHiR3sWAatqfdBS2qQJu
  alt_table: 3vHkJdP614mTtkerR2F4cysx2QiPLZDXusCuqsLbpwbS
  pool: 5BUwFW4nRbftYTDMbgxykoFWqWHPzahFSNAaaaJtVKsq
  perpetuals: H4ND9aYttUVLFmNypZqLjZ52FYiGvdEB45GmwNoKEjTj
  lp_token_mint:
    coin: JLP
    decimals: 6
    token_address: 27G8MtK7VtTcCHkpASjSDdkWWYfoqT6ggEuKidVJidD4
  accounts:
    - 7xS2gz2bTp3fwCC7knJvUWTEU9Tycczu6VhJYKgi1wdz
    - AQCGyheWPLeo6Qp9WpYS9m3Qj479t7R636N9ey1rEjEn
    - 5Pv3gM9JrFFH883SWAhvJC9RPYmo8UNxuFtv5bMMALkm
    - G18jKKXQwBbrHeiK3C9MRXhkHsLHf7XgCSisykV46EZa
    - 4vkNeXiYEUizLdrpdPS1eC2mccyM4NUPRtERrk6ZETkk
    - FYq2BWQ1V5P1WFBqr3qB2Kb5yHVvSv7upzKodgQE5zXh
    - AFZnHPzy4mvVCffrVwhewHbFc93uTHvDSFrVH7GtfXF1
    - hUqAT1KQ7eW1i6Csp9CXYtpPfSAvi835V7wKi5fRfmC
    - 6Jp2xZUTWdDD2ZyUPRzeMdc6AFQ5K3pFgZxk2EijfjnM
    - Fgc93D641F8N2d1xLjQ4jmShuD3GE3BsCXA56KBQbF5u
    - 7UVimffxr9ow1uXYxsr4LHAcV58mLzhmwaeKvJ1pjLiE
    - 42amVS4KgzR9rA28tkVYqVXjq9Qa8dcZQMbH5EYFX6XC
    - 4cSM2e6rvbGQUFiJbqytoVMi5GgghSMr8LwVrT9VPSPo
    - Dpw1EAVrSB1ibxiDQyTAW6Zip3J4Btk2x4SgApQCeFbX
    - HT2PLQBcG5EiCcNSaMHAjSgd9F98ecpATbk4Sk5oYuM

  coins:
    - coin: WSOL
      decimals: 9
      token_address: So11111111111111111111111111111111111111112
      input_accounts:
        funding_account: <account for your WSOL>
        lp_token_account: <account for your JLP>
        transfer_authority: AVzP2GeRmqGphJsMxWoqjpUifPpCret7LqWhD8NWQK49
        perpetuals: H4ND9aYttUVLFmNypZqLjZ52FYiGvdEB45GmwNoKEjTj
        pool: 5BUwFW4nRbftYTDMbgxykoFWqWHPzahFSNAaaaJtVKsq
        custody: 7xS2gz2bTp3fwCC7knJvUWTEU9Tycczu6VhJYKgi1wdz
        custody_doves_price_account: FYq2BWQ1V5P1WFBqr3qB2Kb5yHVvSv7upzKodgQE5zXh
        custody_pythnet_price_account: 7UVimffxr9ow1uXYxsr4LHAcV58mLzhmwaeKvJ1pjLiE
        custody_token_account: BUvduFTd2sWFagCunBPLupG8fBTJqweLw9DuhruNFSCm
        lp_token_mint: 27G8MtK7VtTcCHkpASjSDdkWWYfoqT6ggEuKidVJidD4
        token_program: TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA
        event_authority: 37hJBDnntwqhGbK7L6M1bLyvccj4u55CCUiLPdYkiqBN
        program: PERPHjGBqRHArX4DySjwM6UJHiR3sWAatqfdBS2qQJu
```

Please notice that for given configuration only multisig information changes. In addition, if you decide to provide liquidity
in any other token then all you need is to add a new item inside `coins` array, all you need is to find an example transaction on [solscan.io](https://solscan.io) and copy several fields from there into your config. You must never modify `accounts` field, they are all the same for every type of liquidity. Usually everything stays the same except `custody`, `custody_doves_price_account`, `custody_pythnet_price_account`, `custody_token_account`, `funding_account` and `lp_token_account`

# Running

## Execute Wormhole Transfer to Ethereum

Example of how to run the script:

```bash
yarn run wormhole-ethereum --amount 123WBTC --recepient 0xABCDEF... --fee-tolerance 100
```

Notice that `--amount` option is case sensetive and should be used with capital letters. `--recepient` is a hex address in ethereum network who will receive these tokens. `--fee-tolerance` is a maximum fee tolerance for token bridge relayer. Please note that this option is only make sence in time when we create a proposal, not executing it.

## Add Liquidity

### Add Liquidity %

Example of how to run the script:

```bash
yarn run add-liquidity --amount 123USDC --slippage-tolerance 0.01
```

Notice that `--amount` option is case sensetive and should be used with capital letters. `--slippage-tolerance` is a ratio, where `1.0` is 100% and means how many tokens we're okay to loose in case if we provide a significant amount of tokens.

### Add Liquidity Absolute

Example of how to run the script:

```bash
yarn run start absolute-add-liquidity --amount 123USDC --min-lp-amount-out 1
```

Same as `Remove Liquidity %`, but with `--min-lp-amount-out` (denomination 6 because it's a JLP token). It should be an unsigned integer value that represents an absolute value (minLpAmountOut from the pool)

## Remove Liquidity

### Remove Liquidity %

Example of how to run the script:

```bash
yarn run remove-liquidity --amount 123JLP --slippage-tolerance 0.5 --denom-out USDC
```

Notice that `--amount` option is case sensetive and should be used with capital letters, in case of `remove-liquidity` script it always must have JLP denom at the end. `--denom-out` is a denomination of a token you want to perform a withdrawal in. `--slippage-tolerance` is a ratio, where `1.0` is 100% and means how many tokens we're agree to loose in case if we provide a significant amount of tokens.

### Remove Liquidity Absolute

Example of how to run the script:

```bash
yarn run start absolute-remove-liquidity --amount 123JLP --min-amount-token-out 1321USDC
```

Same as `Remove Liquidity %`, but with `--min-amount-token-out` option. It should be an unsigned integer value that represents an absolute value (minAmountTokenOut from the pool). Withdrawal denomination can be attached at the end
